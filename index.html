<!doctype html>
<html lang="sk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mobile Unboxer — Single File</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --accent:#10b981;
      --muted:#94a3b8;
      --glass: rgba(255,255,255,0.03);
      --radius:12px;
    }
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{margin:0;background:linear-gradient(180deg,#071022 0%, #0f1724 100%);color:#e6eef8;min-height:100vh;padding:20px}
    .app{max-width:1100px;margin:0 auto}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
    header h1{margin:0;font-size:22px}
    .hud{display:flex;gap:12px;align-items:center}
    button{background:var(--accent);border:0;padding:8px 12px;border-radius:8px;color:#021017;cursor:pointer;font-weight:600}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    main{display:grid;grid-template-columns:1fr 1fr;gap:18px}
    .store, .inventory{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .unboxArea{grid-column:1/-1;background:var(--card);padding:14px;border-radius:12px}
    .cards{display:flex;gap:12px;flex-wrap:wrap}
    .card{width:180px;background:var(--glass);padding:10px;border-radius:12px;display:flex;flex-direction:column;align-items:center;text-align:center}
    .card img{width:140px;height:140px;object-fit:contain;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:8px}
    .card .title{font-weight:700;margin-top:8px;font-size:14px}
    .card .price{color:var(--muted);margin-top:6px}
    .card .actions{margin-top:10px;display:flex;gap:8px}
    .unboxStage{height:340px;border-radius:12px;background:linear-gradient(180deg,#071022,#0b1220);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
    .unboxStage img{max-height:100%;max-width:100%;display:block}
    .hidden{display:none}
    footer{margin-top:18px;color:var(--muted)}
    small code{background:rgba(255,255,255,0.03);padding:2px 6px;border-radius:6px}
    .muted{color:var(--muted)}
    @media (max-width:900px){
      main{grid-template-columns:1fr;align-items:start}
      .card{width:140px}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Mobile Unboxer</h1>
      <div class="hud">
        <div id="credits">Coins: <strong>0</strong></div>
        <button id="earnBtn">Zarobiť +500</button>
        <button id="clearInv" class="secondary">Vyprázdni inventár</button>
      </div>
    </header>

    <main>
      <section class="store">
        <h2>Obchod</h2>
        <div id="storeList" class="cards"></div>
      </section>

      <section class="inventory">
        <h2>Inventár</h2>
        <div id="inventoryList" class="cards"></div>
      </section>

      <section class="unboxArea">
        <h2>Unboxing</h2>
        <div id="unboxStage" class="unboxStage">
          <div id="unboxInstructions" class="muted">Kúp telefón a klikni na "Unbox".</div>
        </div>
      </section>
    </main>

    <footer>
      <small>Pridaj obrázky (napr. <code>s25ultra_store.png</code>) do rovnakého priečinka ako tento súbor.</small>
    </footer>
  </div>

  <script>
  (function(){
    // ---- KONFIGURÁCIA: tu pridaj ďalšie telefóny podľa potreby ----
    const PHONES = [
      {
        id: "s25ultra",
        prefix: "s25ultra_",
        name: "Samsung Galaxy S25 Ultra",
        price: 800,
        rarity: "legendary",
        description: "Top-end flagship. Skvelá kamera a výkon.",
        resale: 0.6
      }
      // Príklad pridania ďalšieho telefónu:
      // { id:"iphone16pro", prefix:"iphone16pro_", name:"iPhone 16 Pro", price:750, rarity:"epic", resale:0.55 }
    ];
    // ------------------------------------------------------------

    // DOM
    const creditsEl = document.querySelector('#credits strong');
    const storeList = document.getElementById('storeList');
    const inventoryList = document.getElementById('inventoryList');
    const unboxStage = document.getElementById('unboxStage');
    const earnBtn = document.getElementById('earnBtn');
    const clearInvBtn = document.getElementById('clearInv');

    // STAV
    let credits = 1000;
    let inventory = []; // položky: {id, phoneId, prefix, name, pricePaid, unlockedImages}

    updateCredits();
    earnBtn.addEventListener('click', ()=>{ credits += 500; flashCredits(); updateCredits(); });
    clearInvBtn.addEventListener('click', ()=>{ if(confirm('Vymazať celý inventár?')){ inventory=[]; renderInventory(); unboxStage.innerHTML = '<div class="muted">Inventár vyprázdnený.</div>'; } });

    // check image exists (tries to load)
    function imgExists(src){
      return new Promise(resolve=>{
        const img = new Image();
        img.onload = ()=>resolve(true);
        img.onerror = ()=>resolve(false);
        img.src = src + '?_=' + Date.now();
      });
    }

    function updateCredits(){ creditsEl.textContent = credits; }
    function flashCredits(){ creditsEl.parentElement.animate([{transform:'scale(1)'},{transform:'scale(1.06)'}],{duration:220, easing:'ease-out'}); }

    // render store
    async function renderStore(){
      storeList.innerHTML = '';
      for(const p of PHONES){
        // pick thumbnail candidate
        const storeName = p.prefix + 'store.png';
        const unboxedName = p.prefix + 'unboxed.png';
        const boxName = p.prefix + 'box.png';
        const hasStore = await imgExists(storeName);
        const imgToShow = hasStore ? storeName : (await imgExists(unboxedName) ? unboxedName : (await imgExists(boxName) ? boxName : null));

        const card = document.createElement('div'); card.className='card';
        const img = document.createElement('img');
        if(imgToShow) img.src = imgToShow;
        else {
          img.alt = 'no image';
          img.style.opacity = 0.45;
          img.style.filter = 'grayscale(0.6)';
          img.src = 'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='512' height='512'><rect width='100%' height='100%' fill='#0b1220'/><text x='50%' y='50%' fill='#93a5b8' font-size='20' font-family='Arial' text-anchor='middle'>${p.prefix} missing</text></svg>`);
        }

        const title = document.createElement('div'); title.className='title'; title.textContent = p.name;
        const price = document.createElement('div'); price.className='price'; price.textContent = `${p.price} Coins • ${p.rarity}`;

        const actions = document.createElement('div'); actions.className='actions';
        const buyBtn = document.createElement('button'); buyBtn.textContent='Kúpiť';
        buyBtn.addEventListener('click', ()=> buyPhone(p));
        const previewBtn = document.createElement('button'); previewBtn.textContent='Preview'; previewBtn.className='secondary';
        previewBtn.addEventListener('click', ()=> previewPhone(p));
        actions.appendChild(buyBtn); actions.appendChild(previewBtn);

        card.appendChild(img); card.appendChild(title); card.appendChild(price); card.appendChild(actions);
        storeList.appendChild(card);
      }
    }

    async function buyPhone(phone){
      if(credits < phone.price){ alert('Nemáš dosť coinov. Klikni Zarobiť.'); return; }
      credits -= phone.price; updateCredits(); flashCredits();

      // zisti dostupné obrázky
      const prefix = phone.prefix;
      const filesToCheck = [
        'unbox_step1.png','unbox_step2.png','unbox_step3.png','unbox_step4.png','unbox_step5.png',
        'unboxed.png','box.png','specs.png','store.png'
      ];
      const unlocked = {};
      for(const f of filesToCheck){
        const path = prefix + f;
        if(await imgExists(path)) unlocked[f] = path;
      }

      const item = {
        id: phone.id + '_' + Date.now(),
        phoneId: phone.id,
        prefix: prefix,
        name: phone.name,
        pricePaid: phone.price,
        unlockedImages: unlocked
      };
      inventory.push(item);
      renderInventory();
      playBoughtMessage(phone);
    }

    function playBoughtMessage(phone){
      unboxStage.innerHTML = '';
      const box = document.createElement('div');
      box.style.textAlign = 'center';
      box.innerHTML = `<div style="font-weight:800;margin-bottom:8px">Kúpené: ${phone.name}</div><div class="muted">Klikni na položku v inventári a potom Unbox.</div>`;
      unboxStage.appendChild(box);
    }

    async function previewPhone(phone){
      unboxStage.innerHTML = '';
      const imgEl = document.createElement('img');
      const tryList = [phone.prefix + 'unboxed.png', phone.prefix + 'store.png', phone.prefix + 'box.png'];
      for(const s of tryList){
        if(await imgExists(s)){ imgEl.src = s; break; }
      }
      if(!imgEl.src){
        unboxStage.innerHTML = '<div class="muted">Preview: žiadny obrázok (nahraj PREFIX_unboxed.png alebo PREFIX_store.png).</div>';
      } else unboxStage.appendChild(imgEl);
    }

    function renderInventory(){
      inventoryList.innerHTML = '';
      for(const item of inventory){
        const card = document.createElement('div'); card.className='card';
        const img = document.createElement('img');
        const unlocked = item.unlockedImages || {};
        img.src = unlocked['box.png'] || unlocked['unboxed.png'] || unlocked['store.png'] || ('data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='512' height='512'><rect width='100%' height='100%' fill='#0b1220'/><text x='50%' y='50%' fill='#93a5b8' font-size='20' font-family='Arial' text-anchor='middle'>no image</text></svg>`));
        const title = document.createElement('div'); title.className='title'; title.textContent = item.name;
        const price = document.createElement('div'); price.className='price'; price.textContent = `Kúpené za ${item.pricePaid} • id ${item.id.slice(-5)}`;

        const actions = document.createElement('div'); actions.className='actions';
        const unboxBtn = document.createElement('button'); unboxBtn.textContent='Unbox';
        unboxBtn.addEventListener('click', ()=> unboxItem(item));
        const sellBtn = document.createElement('button'); sellBtn.textContent='Predaj'; sellBtn.className='secondary';
        sellBtn.addEventListener('click', ()=> sellItem(item));
        actions.appendChild(unboxBtn); actions.appendChild(sellBtn);

        card.appendChild(img); card.appendChild(title); card.appendChild(price); card.appendChild(actions);
        inventoryList.appendChild(card);
      }
    }

    async function unboxItem(item){
      unboxStage.innerHTML = '';
      const prefix = item.prefix;
      const steps = [];
      // najprv over kroky 1..10
      for(let i=1;i<=10;i++){
        const path = prefix + 'unbox_step' + i + '.png';
        if(await imgExists(path)) steps.push(path);
        else { if(steps.length>0) break; }
      }

      if(steps.length === 0 && item.unlockedImages['unboxed.png']){
        const final = document.createElement('img'); final.src = item.unlockedImages['unboxed.png']; unboxStage.appendChild(final); return;
      }

      if(steps.length > 0){
        const img = document.createElement('img'); unboxStage.appendChild(img);
        for(const s of steps){ img.src = s; await wait(650); }
        if(item.unlockedImages['unboxed.png']) { await wait(300); img.src = item.unlockedImages['unboxed.png']; }
        return;
      }

      unboxStage.innerHTML = '<div class="muted">Unboxing neobsahuje žiadne obrázky.</div>';
    }

    function wait(ms){ return new Promise(res=>setTimeout(res, ms)); }

    function sellItem(item){
      const phoneDef = PHONES.find(p=>p.id===item.phoneId) || {};
      const resaleRate = phoneDef.resale || 0.5;
      const resaleGain = Math.round((phoneDef.price || item.pricePaid) * resaleRate);
      credits += resaleGain;
      const idx = inventory.indexOf(item);
      if(idx>=0) inventory.splice(idx,1);
      updateCredits();
      renderInventory();
      unboxStage.innerHTML = `<div style="text-align:center"><div style="font-weight:800">Predané: ${item.name}</div><div class="muted">Získal si ${resaleGain} coinov.</div></div>`;
    }

    // inicializácia
    (async ()=>{
      await renderStore();
      renderInventory();
    })();

    // Tip pre používateľa: funkcia na rýchle pridanie sample obrázka (len pre test)
    window._debugAddPlaceholder = async function(prefix, name){
      // vytvor jednoduchý svg data uri a zobraz ho do stage — neukladá súbor
      unboxStage.innerHTML = '';
      const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'><rect width='100%' height='100%' fill='#0b1220'/><text x='50%' y='50%' fill='#93a5b8' font-size='28' font-family='Arial' text-anchor='middle'>${name}</text></svg>`;
      const img = document.createElement('img'); img.src = 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
      unboxStage.appendChild(img);
    };

  })();
  </script>
</body>
</html>
